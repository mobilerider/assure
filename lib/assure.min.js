/*
 2014 Jason Mulligan
 @license BSD-3 <https://raw.github.com/avoidwork/assure/master/LICENSE>
 @link http://avoidwork.github.io/assure/
 @module assure
 @version 1.0.4
*/
(function(f){function k(){return new c}function h(a,b){for(var d=a.length,c=-1;++c<d&&!1!==b.call(a,a[c],c););return a}function m(a,b){a.then(function(a){b.resolve(a)},function(a){b.reject(a)})}function n(){return new g}function g(){this.deferred=!1;this.handlers=[];this.state=e.PENDING;this.value=null}k.when=function(){var a=0,b=k(),d=[].slice.call(arguments),c;d[0]instanceof Array&&(d=d[0]);c=d.length;0===c?b.resolve(null):h(d,function(e){e.then(function(){++a!==c||b.isResolved()||(1<d.length?b.resolve(d.map(function(a){return a.value||
a.promise.value})):b.resolve(d[0].value||d[0].promise.value))},function(){b.isResolved()||(1<d.length?b.reject(d.map(function(a){return a.value||a.promise.value})):b.reject(d[0].value||d[0].promise.value))})});return b};var c;"Promise"in f&&"cast"in f.Promise&&"resolve"in f.Promise&&"reject"in f.Promise&&"all"in f.Promise&&"race"in f.Promise&&function(){var a;return new f.Promise(function(b){a=b})&&"function"===typeof a}()?c=f.Promise:(c=function(){var a=this;this.promise=n();this.onDone=[];this.onAlways=
[];this.onFail=[];this.promise.then(function(b){l(function(){h(a.onDone,function(a){a(b)});h(a.onAlways,function(a){a(b)});a.onAlways=[];a.onDone=[];a.onFail=[]})},function(b){l(function(){h(a.onFail,function(a){a(b)});h(a.onAlways,function(a){a(b)});a.onAlways=[];a.onDone=[];a.onFail=[]})})},c.prototype.constructor=c,c.prototype.always=function(a){this.isResolved()||this.isRejected()||"function"!=typeof a||this.onAlways.push(a);return this},c.prototype.done=function(a){this.isResolved()||this.isRejected()||
"function"!=typeof a||this.onDone.push(a);return this},c.prototype.fail=function(a){this.isResolved()||this.isRejected()||"function"!=typeof a||this.onFail.push(a);return this},c.prototype.isRejected=function(){return this.promise.state===e.FAILURE},c.prototype.isResolved=function(){return this.promise.state===e.SUCCESS},c.prototype.reject=function(a){this.promise.reject(a);return this},c.prototype.resolve=function(a){this.promise.resolve(a);return this},c.prototype.state=function(){return this.promise.state},
c.prototype.then=function(a,b){return this.promise.then(a,b)});var l=function(){return"undefined"!=typeof setImmediate?setImmediate:"undefined"!=typeof process?process.nextTick:function(a){setTimeout(a,0)}}();g.prototype.constructor=g;g.prototype.process=function(){var a,b;this.deferred=!1;if(this.state===e.PENDING)return this;b=this.value;a=this.state===e.SUCCESS;h(this.handlers.slice(),function(d){var c=d[a?"success":"failure"];d=d.promise;var e;if(c&&"function"==typeof c){try{e=c(b)}catch(f){d.reject(f);
return}e&&"function"==typeof e.then?m(e,n):d.resolve(e)}else b&&"function"==typeof b.then?m(b,d):a?d.resolve(b):d.reject(b)});return this};g.prototype.reject=function(a){var b=this;if(this.state>e.PENDING)return this;this.value=a;this.state=e.FAILURE;this.deferred||(l(function(){b.process()}),this.deferred=!0);return this};g.prototype.resolve=function(a){var b=this;if(this.state>e.PENDING)return this;this.value=a;this.state=e.SUCCESS;this.deferred||(l(function(){b.process()}),this.deferred=!0);return this};
g.prototype.then=function(a,b){var c=this,f=new g;this.handlers.push({success:a,failure:b,promise:f});this.state>e.PENDING&&!this.deferred&&(l(function(){c.process()}),this.deferred=!0);return f};var e={PENDING:0,FAILURE:1,SUCCESS:2};"undefined"!=typeof exports?module.exports=k:"function"==typeof define?define(function(){return k}):f.assure=k})(this);
//@ sourceMappingURL=assure.map
